<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
  <style>
    :root{
      --bg:#0f1218;
      --surface:#151922;
      --muted:#7c8699;
      --text:#e8eefc;
      --accent:#6aa3ff;
      --accent-2:#e64a30;
      --card:#1a2030cc;
      --ring: 0 0 0 2px rgba(106,163,255,.35), 0 10px 25px rgba(0,0,0,.35);
      --radius:14px;
    }

    /* Reset & base */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(106,163,255,.25), transparent 50%),
        radial-gradient(1200px 600px at 110% 10%, rgba(230,74,48,.18), transparent 55%),
        linear-gradient(180deg, #0f1218, #0b0e14 60%);
    }

    a{color:inherit;text-decoration:none}
    img{display:block;max-width:100%;height:auto}

    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(8px);
      background: color-mix(in oklab, var(--surface) 85%, transparent);
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    header .wrap{
      max-width:1100px; margin:0 auto; padding:16px 20px;
      display:flex; align-items:center; justify-content:space-between; gap:16px;
    }
    .brand{
      display:flex; align-items:center; gap:10px; font-weight:700; letter-spacing:.3px;
    }
    .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--accent)}
    nav ul{display:flex; gap:14px; list-style:none; padding:0; margin:0}
    nav a{
      padding:8px 12px; border-radius:10px; color:#cbd6f6;
      transition: transform .2s ease, background .2s ease, color .2s ease;
    }
    nav a:hover{background:rgba(255,255,255,.06); color:white; transform:translateY(-1px)}
    nav a.active{background:linear-gradient(180deg, rgba(106,163,255,.25), rgba(106,163,255,.05)); color:white; box-shadow: var(--ring)}

    .container{
      max-width:1100px; margin:28px auto; padding:0 20px;
      display:grid; grid-template-columns: 1.8fr .9fr; gap:22px;
    }

    .card{
      background:var(--card);
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      overflow:hidden;
      animation: slideUp .6s ease both;
    }

    .card .pad{padding:18px}

    /* Profile */
    #profile-card .header{
      display:flex; align-items:center; gap:14px; margin-bottom:8px;
    }
    .avatar{
      width:72px;height:72px;border-radius:50%;
      background:linear-gradient(135deg, rgba(106,163,255,.25), rgba(230,74,48,.25));
      padding:2px;
    }
    .avatar img{border-radius:50%}

    .muted{color:var(--muted)}

    /* Composer */
    #new-post textarea{
      width:100%; min-height:110px; resize:vertical;
      padding:12px 14px; border-radius:12px;
      border:1px solid rgba(255,255,255,.08);
      background:#111625; color:var(--text); outline:none;
      transition: box-shadow .2s ease, border-color .2s ease;
    }
    #new-post textarea:focus{border-color:rgba(106,163,255,.6); box-shadow: var(--ring)}
    .btn{
      appearance:none; border:0; padding:10px 14px; border-radius:12px; font-weight:600;
      background:linear-gradient(180deg, color-mix(in oklab, var(--accent) 78%, white 8%), color-mix(in oklab, var(--accent) 60%, black 12%));
      color:#0a0e16;
      box-shadow: 0 8px 18px rgba(106,163,255,.35);
      cursor:pointer; transition: transform .15s ease, box-shadow .2s ease, filter .2s ease;
    }
    .btn:hover{transform:translateY(-1px); filter:saturate(1.05)}
    .btn:active{transform:translateY(0); box-shadow: 0 4px 10px rgba(0,0,0,.35)}

    /* Feed */
    #feed .post{padding:16px 18px; border-top:1px solid rgba(255,255,255,.06)}
    #feed .post:first-child{border-top:0}
    .post h4{margin:0 0 6px 0}
    .meta{font-size:.9rem; color:#9aa6bf}
    .actions{display:flex; gap:10px; margin-top:8px}
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      font-size:.9rem; padding:6px 10px; border-radius:999px;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08);
      transition: background .2s ease, transform .2s ease;
      cursor:default;
    }
    .chip:hover{background:rgba(255,255,255,.09); transform:translateY(-1px)}

    /* Sidebar */
    .sidebar .friend{
      display:flex; align-items:center; gap:10px; padding:10px 12px;
      border-radius:12px; transition: background .2s ease, transform .2s ease;
    }
    .sidebar .friend:hover{background:rgba(255,255,255,.06); transform:translateX(2px)}
    .dot-online{width:8px;height:8px;background:#32d583;border-radius:50%}

    footer{
      max-width:1100px; margin:24px auto 40px; padding:0 20px;
      color:#9aa6bf; text-align:center;
    }

    /* Subtle entrance stagger */
    main .card{animation-delay:.05s}
    main #new-post.card{animation-delay:.12s}
    main #feed.card{animation-delay:.18s}
    .sidebar.card{animation-delay:.22s}

    /* Animations */
    @keyframes slideUp{
      from{opacity:0; transform:translateY(12px)}
      to{opacity:1; transform:translateY(0)}
    }

    /* Responsive */
    @media (max-width: 900px){
      .container{grid-template-columns: 1fr}
      header .wrap{flex-wrap:wrap}
      nav ul{flex-wrap:wrap}
    }
  </style>
</head>
<body>
{% if user %}
    <header>
    <div class="wrap">
      <div class="brand">
        <span class="dot"></span>
        <span>SocialNet</span>
      </div>
      <nav>
        <ul>
          <li><a class="active" href="#">Home</a></li>
          <li><a href="#">Profile</a></li>
          <li><a href="#">Messages</a></li>
          <li><a href="#">Friends</a></li>
          <li><a href="/logout">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∞—É–Ω—Ç–∞</a></li>

        </ul>
      </nav>
    </div>
  </header>
    <div class="container">
        <main class="main">
            <section id="profile-card" class="card">
    <div class="pad">
      <div class="header">
        <div class="avatar">
          <img src="https://via.placeholder.com/72" alt="User Avatar">
        </div>
        <div>
          <h2 style="margin:0">{{ user.name  }}  {{ user.surname }}</h2>
          <div class="muted">@{{ user.username }} ‚Ä¢ Designer &amp; builder</div>
        </div>
      </div>
      <p class="muted">Loves coding, basketball and coffee-fueled night design sprints.</p>
    </div>
  </section>
            <section id="new-post" class="card">
    <div class="pad">
      <h3 style="margin:0 0 10px 0">New Post</h3>
       <form id="postForm" onsubmit="return false">
    <input
      id="postTitle"
      type="text"
      placeholder="Post title"
      required
      style="width:100%; padding:8px; margin-bottom:10px;"
    />

    <textarea
      id="postText"
      placeholder="What's on your mind?"
      required
      rows="5"
      style="width:100%; padding:8px;"
    ></textarea>



    <div style="margin-top:10px; display:flex; gap:8px; justify-content:flex-end; align-items:center;">
      <span id="postStatus" style="font-size:12px; opacity:.8;"></span>
      <button id="postBtn" type="submit" class="btn">Post</button>
    </div>
  </form>
    </div>
  </section>
            <section id="feed" class="card">
    <div class="pad">
      {% for post in posts%}
      <article class="post">
        <h4>{{ user.name }} {{ user.surname }} </h4>
        <p>{{ post.title }}</p>
        <p>{{ post.main_text }}</p>
        <div class="actions">
          <span class="chip">‚ù§Ô∏è 10 Likes</span>
          <span class="chip">üí¨ 2 Comments</span>
        </div>
<!--        <a href="/exact-post/{{ post.id }}"> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å—Ç</a>-->
      </article>
      {% endfor %}
    </div>
  </section>
        </main>
        <aside class="sidebar card">
    <div class="pad">
      <h3 style="margin-top:0">Friends</h3>
      <div class="friend">
        <span class="dot-online"></span>
        <strong>Alice</strong>
      </div>
      <div class="friend">
        <span class="dot-online"></span>
        <strong>Bob</strong>
      </div>
      <div class="friend">
        <span class="dot-online"></span>
        <strong>Charlie</strong>
      </div>
    </div>
  </aside>
    </div>
    <footer>¬© 2025 SocialNet</footer>
{% else %}
<a href="/login">–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è</a>
<a href="/register">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>

{% endif %}


<script>
  const form = document.getElementById("postForm");
  const titleEl = document.getElementById("postTitle");
  const textEl  = document.getElementById("postText");
  const btn     = document.getElementById("postBtn");
  const status  = document.getElementById("postStatus");

  // –ï—Å–ª–∏ uid —Ö—Ä–∞–Ω–∏—à—å –≥–¥–µ-—Ç–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä –≤ localStorage) ‚Äî –ø–æ–¥—Å—Ç–∞–≤—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
  const uidEl = {{user.id}}

  form.addEventListener("submit", async () => {
    // –ø—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
    if (!titleEl.value.trim() || !textEl.value.trim() ) {
      status.textContent = "–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è.";
      return;
    }

    const payload = {
      title: titleEl.value.trim(),
      main_text: textEl.value.trim(),
      uid: Number(uidEl)
    };

    btn.disabled = true;
    status.textContent = "–û—Ç–ø—Ä–∞–≤–ª—è—é‚Ä¶";

    try {
      const res = await fetch("/post/create_post", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      // FastAPI –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–µ—Ä–Ω—ë—Ç 422 –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–π –æ—à–∏–±–∫–µ
      const data = await res.json().catch(() => ({}));

      if (!res.ok) {
        // –ø–æ–∫–∞–∂–µ–º –ø—Ä–∏—á–∏–Ω—É, –µ—Å–ª–∏ –µ—Å—Ç—å detail –∏–∑ FastAPI
        const msg = data?.detail
          ? (Array.isArray(data.detail) ? data.detail.map(d => d.msg).join("; ") : data.detail)
          : `HTTP ${res.status}`;
        status.textContent = "–û—à–∏–±–∫–∞: " + msg;
        btn.disabled = false;
        return;
      }

      // –¢–≤–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç, —Å—É–¥—è –ø–æ –ø—Ä–∏–º–µ—Ä—É, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç {"status": 1, "message": ...}
      if (data.status === 1) {
        status.textContent = "–ü–æ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω ‚úî";
        titleEl.value = "";
        textEl.value = "";
        // uid –æ–±—ã—á–Ω–æ –Ω–µ —á–∏—Å—Ç–∏–º
      } else {
        status.textContent = "–û—à–∏–±–∫–∞: " + (data.message ?? "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");
      }
    } catch (err) {
      console.error(err);
      status.textContent = "–°–µ—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç.";
    } finally {
      btn.disabled = false;
    }
  });
</script>
</body>
</html>